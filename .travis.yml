language: php

php:
  - 5.4

env:
  global:
    - secure: NC1/RA8TEdFCPKZswNm6PffWtE9CNg72rDqYFcKlKmO3RVe6QeIE1+nsyoPh+Bun6rMG4LuaCArd3PMnhLQryCdX1PAlhUD3iy9zF9uhC4MBz0/pDw/WpZJaxAqCcZNilueRBhvPLQ5AUnrtYHa+r/ILp5Ekjn29LuY9UIsYwjQ=
    - secure: SGVPdaSfetcIB6w3LumoziBxAF2Y9ERLs3/2LN41P2Gvx8WjVSj4s+TPzijhUxbSMO9eWy68emcmraTFMJ4izOJGSkvXtiqvISNufkYUmwNtxw9LUyD98W7pf7eFJ6sM7pOUDjsQj8Hebtr69c8m/67oyoi+wu5r8WuxEaUNcyI=

addons:
  sauce_connect: true  

before_install:
  - sudo apt-get update 
  - composer self-update
  - sudo apt-get install -y --force-yes php5-cgi php5-mysql sqlite3 php5-sqlite php5-gd 
  - composer global require drupal/drupal-extension:"~3.0" 
  - composer global require drush/drush:dev-master
  - export PATH="$HOME/.composer/vendor/bin:$PATH"
  - mkdir web
  - cd web
  - drush qd mydrupal --core=drupal-8.0.x --dev --no-cache --yes --profile=standard --no-server --account-mail='a@b.com' --account-name=admin --account-pass=password --site-name=boo  
  - cd mydrupal/drupal-8.0.x
  - drush runserver --server=builtin 8080 --strict=0 &
  - until netstat -an 2>/dev/null | grep '8080.*LISTEN'; do sleep 0.2; done
  - cd modules
  - git clone https://github.com/mohankumargupta/mentionsdrupal8module.git mentions
  #- wget "http://selenium-release.storage.googleapis.com/2.45/selenium-server-standalone-2.45.0.jar"
  #- "sh -e /etc/init.d/xvfb start"
  #- "export DISPLAY=:99.0"
  #- "java -jar selenium-server-standalone-2.45.0.jar > /dev/null &"

before_script:
  - drush en -y mentions
  - drush pm-list --pipe --type=module --status=enabled --no-core | grep -x mentions
  - cd ..
  - behat -c ./modules/mentions/behat.yml -dl
  - cp -a modules/mentions/features .

script:
  - behat -c ./modules/mentions/behat.yml
  - cd core && ./vendor/bin/phpunit
